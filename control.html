<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم موقع رسلان</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f0f4f8; }
        .sidebar { transition: transform 0.3s ease-in-out; }
        .sidebar-link { border-right: 4px solid transparent; }
        .sidebar-link.active { border-right-color: #f59e0b; background-color: #1e3a8a; }
        .modal { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
        .btn-primary { background-color: #1e40af; color: white; }
        .btn-primary:hover { background-color: #1c3d9a; }
        .btn-secondary { background-color: #64748b; color: white; }
        .btn-secondary:hover { background-color: #5a6a7b; }
        .btn-danger { background-color: #dc2626; color: white; }
        .btn-danger:hover { background-color: #b91c1c; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <h2 class="text-2xl font-bold mb-4">الدخول إلى لوحة التحكم</h2>
            <input type="password" id="password-input" class="border-2 border-gray-300 p-2 rounded-md w-full mb-4" placeholder="أدخل كلمة المرور">
            <button id="login-button" class="btn-primary w-full py-2 rounded-md font-bold">دخول</button>
        </div>
    </div>

    <!-- Main Layout -->
    <div id="app-wrapper" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar fixed top-0 right-0 h-full w-64 bg-blue-900 text-white shadow-lg z-40">
            <div class="p-6">
                <h1 class="text-2xl font-bold">لوحة التحكم</h1>
            </div>
            <nav class="mt-8">
                <a href="#" class="sidebar-link active block py-3 px-6 hover:bg-blue-800" data-section="about">
                    <i class="fas fa-info-circle ml-3"></i> قسم من نحن
                </a>
                <a href="#" class="sidebar-link block py-3 px-6 hover:bg-blue-800" data-section="services">
                    <i class="fas fa-concierge-bell ml-3"></i> الخدمات
                </a>
                <a href="#" class="sidebar-link block py-3 px-6 hover:bg-blue-800" data-section="projects">
                    <i class="fas fa-project-diagram ml-3"></i> المشاريع
                </a>
                <a href="#" class="sidebar-link block py-3 px-6 hover:bg-blue-800" data-section="workHeroes">
                    <i class="fas fa-hard-hat ml-3"></i> أبطال أعمالنا
                </a>
                <a href="#" class="sidebar-link block py-3 px-6 hover:bg-blue-800" data-section="team">
                    <i class="fas fa-users ml-3"></i> فريق العمل
                </a>
                 <a href="#" class="sidebar-link block py-3 px-6 hover:bg-blue-800" data-section="clients">
                    <i class="fas fa-handshake ml-3"></i> العملاء
                </a>
                <a href="#" class="sidebar-link block py-3 px-6 hover:bg-blue-800" data-section="contact">
                    <i class="fas fa-envelope ml-3"></i> تواصل معنا
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="mr-64 p-8">
            <div id="loader" class="text-center p-16">
                <i class="fas fa-spinner fa-spin fa-3x text-blue-900"></i>
                <p class="mt-4 text-lg">جاري تحميل البيانات...</p>
            </div>

            <!-- About Section -->
            <section id="about-section" class="content-section">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">تعديل قسم "من نحن"</h2>
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <form id="about-form" class="space-y-6">
                        <h3 class="text-xl font-semibold border-b pb-2">النصوص الرئيسية</h3>
                        <div>
                            <label class="block font-medium">الفقرة الرئيسية (عربي)</label>
                            <textarea id="aboutP1Ar" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                        <div>
                            <label class="block font-medium">الفقرة الرئيسية (إنجليزي)</label>
                            <textarea id="aboutP1En" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                        <h3 class="text-xl font-semibold border-b pb-2">الرؤية</h3>
                        <div>
                            <label class="block font-medium">نص الرؤية (عربي)</label>
                            <textarea id="visionP1Ar" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                         <div>
                            <label class="block font-medium">نص الرؤية (إنجليزي)</label>
                            <textarea id="visionP1En" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                        <h3 class="text-xl font-semibold border-b pb-2">المهمة</h3>
                         <div>
                            <label class="block font-medium">عنوان السرعة (عربي)</label>
                            <input type="text" id="missionSpeedAr" class="w-full border-2 p-2 rounded-md">
                        </div>
                        <div>
                            <label class="block font-medium">عنوان السرعة (إنجليزي)</label>
                            <input type="text" id="missionSpeedEn" class="w-full border-2 p-2 rounded-md">
                        </div>
                         <div>
                            <label class="block font-medium">وصف السرعة (عربي)</label>
                            <textarea id="missionSpeedDescAr" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                        <div>
                            <label class="block font-medium">وصف السرعة (إنجليزي)</label>
                            <textarea id="missionSpeedDescEn" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                        <div>
                            <label class="block font-medium">عنوان السعر (عربي)</label>
                            <input type="text" id="missionPriceAr" class="w-full border-2 p-2 rounded-md">
                        </div>
                         <div>
                            <label class="block font-medium">عنوان السعر (إنجليزي)</label>
                            <input type="text" id="missionPriceEn" class="w-full border-2 p-2 rounded-md">
                        </div>
                        <div>
                            <label class="block font-medium">وصف السعر (عربي)</label>
                            <textarea id="missionPriceDescAr" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>
                         <div>
                            <label class="block font-medium">وصف السعر (إنجليزي)</label>
                            <textarea id="missionPriceDescEn" class="w-full border-2 p-2 rounded-md h-24"></textarea>
                        </div>

                        <h3 class="text-xl font-semibold border-b pb-2">الصور</h3>
                        <div>
                            <label class="block font-medium">رابط الصورة الأولى</label>
                            <input type="url" id="aboutImg1Url" class="w-full border-2 p-2 rounded-md ltr-input" dir="ltr">
                            <img id="aboutImg1Preview" class="mt-2 h-32 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block font-medium">رابط الصورة الثانية</label>
                            <input type="url" id="aboutImg2Url" class="w-full border-2 p-2 rounded-md ltr-input" dir="ltr">
                             <img id="aboutImg2Preview" class="mt-2 h-32 rounded-md shadow-sm">
                        </div>
                        <button type="submit" class="btn-primary px-8 py-2 rounded-md font-bold">حفظ التغييرات</button>
                    </form>
                </div>
            </section>

            <!-- Dynamic Sections (Services, Projects, etc.) -->
            <section id="dynamic-list-section" class="content-section hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 id="dynamic-section-title" class="text-3xl font-bold text-gray-800"></h2>
                    <button id="add-new-item-btn" class="btn-primary px-6 py-2 rounded-md font-bold flex items-center gap-2">
                        <i class="fas fa-plus"></i> إضافة عنصر جديد
                    </button>
                </div>
                <div id="items-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Items will be rendered here -->
                </div>
            </section>

             <!-- Contact Section -->
            <section id="contact-section" class="content-section hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">تعديل قسم "تواصل معنا"</h2>
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <form id="contact-form" class="space-y-6">
                         <div>
                            <label class="block font-medium">العنوان (عربي)</label>
                            <input type="text" id="contactAddressAr" class="w-full border-2 p-2 rounded-md">
                        </div>
                         <div>
                            <label class="block font-medium">العنوان (إنجليزي)</label>
                            <input type="text" id="contactAddressEn" class="w-full border-2 p-2 rounded-md">
                        </div>
                        <div>
                            <label class="block font-medium">البريد الإلكتروني</label>
                            <input type="email" id="contactEmail" class="w-full border-2 p-2 rounded-md ltr-input" dir="ltr">
                        </div>
                        <div>
                            <label class="block font-medium">رقم الهاتف</label>
                            <input type="tel" id="contactPhone" class="w-full border-2 p-2 rounded-md ltr-input" dir="ltr">
                        </div>
                        <div>
                            <label class="block font-medium">رقم واتساب العائم (مع كود الدولة)</label>
                            <input type="text" id="contactWhatsappFloatPhone" class="w-full border-2 p-2 rounded-md ltr-input" dir="ltr">
                        </div>
                        <div>
                            <label class="block font-medium">رابط تضمين خريطة جوجل</label>
                            <textarea id="contactMapIframeSrc" class="w-full border-2 p-2 rounded-md ltr-input h-24" dir="ltr"></textarea>
                        </div>
                        <button type="submit" class="btn-primary px-8 py-2 rounded-md font-bold">حفظ التغييرات</button>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for Add/Edit -->
    <div id="item-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden opacity-0">
        <div class="modal-content bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl transform -translate-y-10">
            <h3 id="modal-title" class="text-2xl font-bold mb-6"></h3>
            <form id="modal-form" class="space-y-4">
                <input type="hidden" id="modal-item-id">
                 <!-- Form fields will be dynamically added here -->
            </form>
             <div class="flex justify-end gap-4 mt-6">
                <button id="modal-cancel-btn" class="btn-secondary px-6 py-2 rounded-md">إلغاء</button>
                <button id="modal-save-btn" class="btn-primary px-6 py-2 rounded-md">حفظ</button>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getDatabase, ref, get, set, update, remove, push } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyA12fSyvBCdVF62xVwGaEuJXlJOpGEMoKI",
            authDomain: "raslan2025-47c6c.firebaseapp.com",
            databaseURL: "https://raslan2025-47c6c-default-rtdb.firebaseio.com",
            projectId: "raslan2025-47c6c",
            storageBucket: "raslan2025-47c6c.appspot.com",
            messagingSenderId: "320802083048",
            appId: "1:320802083048:web:3c2d279b270443bfbc395d",
            measurementId: "G-W1GWY4X7D6"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- State Management ---
        let currentSection = 'about';
        let sectionsData = {};

        // --- App Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const loginButton = document.getElementById('login-button');
            loginButton.addEventListener('click', () => {
                // IMPORTANT: Replace "12345" with your own secure password.
                if (document.getElementById('password-input').value === '12345') {
                    document.getElementById('auth-overlay').classList.add('hidden');
                    document.getElementById('app-wrapper').classList.remove('hidden');
                    initializeAppLogic();
                } else {
                    alert('كلمة المرور غير صحيحة!');
                }
            });
        });
        
        async function initializeAppLogic() {
            setupEventListeners();
            await loadAllData();
            navigateToSection('about');
        }

        async function loadAllData() {
            document.getElementById('loader').classList.remove('hidden');
            const sectionsToLoad = ['about', 'services', 'projects', 'workHeroes', 'team', 'clients', 'contact'];
            for (const section of sectionsToLoad) {
                 const snapshot = await get(ref(db, section));
                 if(snapshot.exists()) {
                     sectionsData[section] = snapshot.val();
                 }
            }
            document.getElementById('loader').classList.add('hidden');
        }

        // --- Navigation ---
        function navigateToSection(sectionId) {
             currentSection = sectionId;

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.add('hidden'));
            
            // Update active link
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.toggle('active', link.dataset.section === sectionId);
            });

            if (['services', 'projects', 'workHeroes', 'team', 'clients'].includes(sectionId)) {
                renderDynamicList(sectionId);
                document.getElementById('dynamic-list-section').classList.remove('hidden');
            } else {
                 if (sectionId === 'about') {
                     populateAboutForm();
                     document.getElementById('about-section').classList.remove('hidden');
                 } else if (sectionId === 'contact') {
                     populateContactForm();
                     document.getElementById('contact-section').classList.remove('hidden');
                 }
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateToSection(e.currentTarget.dataset.section);
                });
            });

            document.getElementById('about-form').addEventListener('submit', saveAboutForm);
            document.getElementById('contact-form').addEventListener('submit', saveContactForm);
            document.getElementById('add-new-item-btn').addEventListener('click', () => openModalForNew());
            document.getElementById('modal-cancel-btn').addEventListener('click', closeModal);
            document.getElementById('modal-form').addEventListener('submit', saveModalForm);
        }
        
        // --- Form Population & Saving ---
        function populateAboutForm() {
            const data = sectionsData.about || {};
            document.getElementById('aboutP1Ar').value = data.aboutP1Ar || '';
            document.getElementById('aboutP1En').value = data.aboutP1En || '';
            document.getElementById('visionP1Ar').value = data.visionP1Ar || '';
            document.getElementById('visionP1En').value = data.visionP1En || '';
            document.getElementById('missionSpeedAr').value = data.missionSpeedAr || '';
            document.getElementById('missionSpeedEn').value = data.missionSpeedEn || '';
            document.getElementById('missionSpeedDescAr').value = data.missionSpeedDescAr || '';
            document.getElementById('missionSpeedDescEn').value = data.missionSpeedDescEn || '';
            document.getElementById('missionPriceAr').value = data.missionPriceAr || '';
            document.getElementById('missionPriceEn').value = data.missionPriceEn || '';
            document.getElementById('missionPriceDescAr').value = data.missionPriceDescAr || '';
            document.getElementById('missionPriceDescEn').value = data.missionPriceDescEn || '';
            document.getElementById('aboutImg1Url').value = data.aboutImg1Url || '';
            document.getElementById('aboutImg2Url').value = data.aboutImg2Url || '';
            document.getElementById('aboutImg1Preview').src = data.aboutImg1Url || '';
            document.getElementById('aboutImg2Preview').src = data.aboutImg2Url || '';
        }

        async function saveAboutForm(e) {
            e.preventDefault();
            const dataToSave = {
                aboutP1Ar: document.getElementById('aboutP1Ar').value,
                aboutP1En: document.getElementById('aboutP1En').value,
                visionP1Ar: document.getElementById('visionP1Ar').value,
                visionP1En: document.getElementById('visionP1En').value,
                missionSpeedAr: document.getElementById('missionSpeedAr').value,
                missionSpeedEn: document.getElementById('missionSpeedEn').value,
                missionSpeedDescAr: document.getElementById('missionSpeedDescAr').value,
                missionSpeedDescEn: document.getElementById('missionSpeedDescEn').value,
                missionPriceAr: document.getElementById('missionPriceAr').value,
                missionPriceEn: document.getElementById('missionPriceEn').value,
                missionPriceDescAr: document.getElementById('missionPriceDescAr').value,
                missionPriceDescEn: document.getElementById('missionPriceDescEn').value,
                aboutImg1Url: document.getElementById('aboutImg1Url').value,
                aboutImg2Url: document.getElementById('aboutImg2Url').value,
                 // Retain other fields not in the form
                visionTitleAr: sectionsData.about.visionTitleAr,
                visionTitleEn: sectionsData.about.visionTitleEn,
                missionTitleAr: sectionsData.about.missionTitleAr,
                missionTitleEn: sectionsData.about.missionTitleEn,
            };
            try {
                await update(ref(db, 'about'), dataToSave);
                sectionsData.about = dataToSave;
                alert('تم حفظ قسم "من نحن" بنجاح!');
            } catch (error) {
                alert('حدث خطأ أثناء الحفظ: ' + error.message);
            }
        }
        
        function populateContactForm() {
            const data = sectionsData.contact || {};
            document.getElementById('contactAddressAr').value = data.addressAr || '';
            document.getElementById('contactAddressEn').value = data.addressEn || '';
            document.getElementById('contactEmail').value = data.email || '';
            document.getElementById('contactPhone').value = data.phone || '';
            document.getElementById('contactWhatsappFloatPhone').value = data.whatsappFloatPhone || '';
            document.getElementById('contactMapIframeSrc').value = data.mapIframeSrc || '';
        }

        async function saveContactForm(e) {
             e.preventDefault();
            const dataToSave = {
                addressAr: document.getElementById('contactAddressAr').value,
                addressEn: document.getElementById('contactAddressEn').value,
                email: document.getElementById('contactEmail').value,
                phone: document.getElementById('contactPhone').value,
                whatsappFloatPhone: document.getElementById('contactWhatsappFloatPhone').value,
                mapIframeSrc: document.getElementById('contactMapIframeSrc').value
            };
            try {
                await update(ref(db, 'contact'), dataToSave);
                sectionsData.contact = dataToSave;
                alert('تم حفظ قسم "تواصل معنا" بنجاح!');
            } catch (error) {
                alert('حدث خطأ أثناء الحفظ: ' + error.message);
            }
        }

        // --- Dynamic List Rendering ---
        const sectionConfig = {
            services: { title: 'الخدمات', fields: { titleAr: 'text', titleEn: 'text', descAr: 'textarea', descEn: 'textarea', imageUrl: 'url' } },
            projects: { title: 'المشاريع', fields: { titleAr: 'text', titleEn: 'text', descAr: 'textarea', descEn: 'textarea', imageUrl: 'url' } },
            team: { title: 'فريق العمل', fields: { nameAr: 'text', nameEn: 'text', positionAr: 'text', positionEn: 'text', imageUrl: 'url' } },
            workHeroes: { title: 'أبطال أعمالنا', fields: { imageUrl: 'url' } },
            clients: { title: 'العملاء', fields: { logoUrl: 'url' } },
        };

        function renderDynamicList(sectionId) {
            const config = sectionConfig[sectionId];
            document.getElementById('dynamic-section-title').textContent = config.title;
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            const items = sectionsData[sectionId];

            if (items) {
                Object.entries(items).forEach(([id, item]) => {
                    const title = item.titleAr || item.nameAr || `عنصر ${id}`;
                    const image = item.imageUrl || item.logoUrl || 'https://placehold.co/600x400/e2e8f0/e2e8f0?text=No+Image';
                    const card = `
                        <div class="bg-white p-4 rounded-lg shadow-md flex flex-col justify-between">
                            <img src="${image}" class="h-40 w-full object-cover rounded-md mb-4">
                            <h4 class="font-bold text-lg mb-4 truncate">${title}</h4>
                            <div class="flex gap-2 justify-end">
                                <button class="btn-primary px-4 py-1 rounded-md text-sm" onclick="window.openModalForEdit('${sectionId}', '${id}')">تعديل</button>
                                <button class="btn-danger px-4 py-1 rounded-md text-sm" onclick="window.deleteItem('${sectionId}', '${id}')">حذف</button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } else {
                 container.innerHTML = `<p class="text-gray-500 col-span-full">لا توجد عناصر في هذا القسم بعد.</p>`;
            }
        }

        // --- Modal Logic ---
        function openModalForNew() {
            document.getElementById('modal-item-id').value = '';
            document.getElementById('modal-title').textContent = `إضافة ${sectionConfig[currentSection].title} جديد`;
            generateModalFormFields(currentSection);
            document.getElementById('item-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('item-modal').classList.remove('opacity-0'), 10);
        }

        window.openModalForEdit = function(sectionId, itemId) {
            const item = sectionsData[sectionId][itemId];
            document.getElementById('modal-item-id').value = itemId;
            document.getElementById('modal-title').textContent = `تعديل ${sectionConfig[sectionId].title}`;
            generateModalFormFields(sectionId, item);
            document.getElementById('item-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('item-modal').classList.remove('opacity-0'), 10);
        }
        
        function closeModal() {
            document.getElementById('item-modal').classList.add('opacity-0');
            setTimeout(() => document.getElementById('item-modal').classList.add('hidden'), 300);
        }

        function generateModalFormFields(sectionId, itemData = {}) {
            const form = document.getElementById('modal-form');
            form.innerHTML = '<input type="hidden" id="modal-item-id">';
            document.getElementById('modal-item-id').value = itemData.id || '';
            
            const fields = sectionConfig[sectionId].fields;
            for (const [key, type] of Object.entries(fields)) {
                let fieldHtml = '';
                const value = itemData[key] || '';
                const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                
                if (type === 'textarea') {
                    fieldHtml = `<div><label class="block font-medium">${label}</label><textarea id="modal-${key}" class="w-full border-2 p-2 rounded-md h-24">${value}</textarea></div>`;
                } else {
                    fieldHtml = `<div><label class="block font-medium">${label}</label><input type="${type}" id="modal-${key}" value="${value}" class="w-full border-2 p-2 rounded-md"></div>`;
                }
                form.innerHTML += fieldHtml;
            }
        }
        
        async function saveModalForm(e) {
            e.preventDefault();
            const itemId = document.getElementById('modal-item-id').value;
            const dataToSave = {};
            const fields = sectionConfig[currentSection].fields;

            for (const key in fields) {
                dataToSave[key] = document.getElementById(`modal-${key}`).value;
            }

            try {
                if (itemId) { // Update existing item
                    await update(ref(db, `${currentSection}/${itemId}`), dataToSave);
                    sectionsData[currentSection][itemId] = dataToSave;
                } else { // Add new item
                    const newItemRef = push(ref(db, currentSection));
                    await set(newItemRef, dataToSave);
                    sectionsData[currentSection] = {...sectionsData[currentSection], [newItemRef.key]: dataToSave};
                }
                alert('تم الحفظ بنجاح!');
                renderDynamicList(currentSection);
                closeModal();
            } catch(error) {
                alert('حدث خطأ: ' + error.message);
            }
        }
        
        // --- Delete Logic ---
        window.deleteItem = async function(sectionId, itemId) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذا العنصر؟ لا يمكن التراجع عن هذا الإجراء.')) {
                try {
                    await remove(ref(db, `${sectionId}/${itemId}`));
                    delete sectionsData[sectionId][itemId];
                    renderDynamicList(sectionId);
                    alert('تم الحذف بنجاح.');
                } catch (error) {
                    alert('حدث خطأ أثناء الحذف: ' + error.message);
                }
            }
        }

    </script>
</body>
</html>
